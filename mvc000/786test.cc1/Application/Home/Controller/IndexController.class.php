<?phpnamespace Home\Controller;use Think\Controller;class IndexController extends CommonController{    public function index(){        $apps = M('category')->where(array('status'=>1))->field('id,name,short_name,type,icon_url')->order('sort desc')->select();        $M=M();        $notice = M('notice')->field('name,memo,status')->find();        $this->assign("notice",$notice);        $apps_post= $M->field('p.username as username,c.name as name')->table("tp_category c,tp_post p")->where("c.id=p.cate_id and p.status=1")->order("p.id DESC")->limit(20)->select();        $this->assign("apps",$apps);        $this->assign("apps_post",$apps_post);				        $this->display();    }    public function ta(){            $id = intval($_REQUEST['cid']);            $info = D('Category')->where(array('id'=>$id))->find();			            $fieldsAry = C('CUSTOM_FIELDS');            $fields = array();            $tmp = array();			            foreach($fieldsAry as $key => $field){                if($info[$key] == 2) continue;                $fields[] = array('sort'=>$info[$key.'_sort'],'title'=>$fieldsAry[$key], 'name'=>$key);                $tmp[] = $info[$key.'_sort'];				            }            array_multisort($tmp, SORT_DESC, $fields);  //多维排序			            $this->assign('info', $info);            $this->assign('fields', $fields);            $data['status']  = 1;												$str = json_encode($fields);			$this->ajaxReturn($str);		            $this->fetch('ajaxlist');  			 			            //$this->ajaxReturn($data);            //$this->display();            }		public function ta2(){							$id = $_POST['id'];			 						$info = D('Category')->where(array('id'=>$id))->find();			$fieldsAry = C('CUSTOM_FIELDS');			$fields = array();			$tmp = array();			foreach($fieldsAry as $key => $field){				if($info[$key] == 2) continue;				$fields[] = array('sort'=>$info[$key.'_sort'],'title'=>$fieldsAry[$key], 'name'=>$key);				$tmp[] = $info[$key.'_sort'];			}			array_multisort($tmp, SORT_DESC, $fields);  //多维排序						$this->assign('info', $info);			$this->assign('fields', $fields);			 $data['status']  = 1;			             $this->ajaxReturn($data);            $this->display();		/*             $id = $_POST['id'];            $info = D('Category')->where(array('id'=>$id))->find();            $fieldsAry = C('CUSTOM_FIELDS');            $fields = array();            $tmp = array();            foreach($fieldsAry as $key => $field){                if($info[$key] == 2) continue;                $fields[] = array('sort'=>$info[$key.'_sort'],'title'=>$fieldsAry[$key], 'name'=>$key);                $tmp[] = $info[$key.'_sort'];            }            array_multisort($tmp, SORT_DESC, $fields);              $this->assign('info', $info);            $this->assign('fields', $fields);            $data['status']  = 1;            $this->ajaxReturn($data);            $this->display(); */    }					public function clearpost(){  	  //  DELETE FROM `tp_post` WHERE `addtime` <=1611627374;  	     $addtime=     strtotime("-2 day");                 $map['addtime']  = array('elt',$addtime);          D("Post")->where($map)->delete();         echo "清除".date('Y-m-d H:i:s',$addtime)."之前的数据成功！";	    	}	}